Unique ID Generator Design
---------------------

A distributed unique ID generator. Storing as a 60-bit integer while displaying
as a 10-character long base64-like string.

### Storage and Generator

#### Storage Format
```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 0 0 0|                      Timestamp                         
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |   Worker ID     |  Sequence Number  |   Random Bits   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```
#### 1. Timestamp: 32-bit

Seconds elapsed since `'2018-03-01T00:00:00Z'`.

#### 2. Worker ID: 9-bit

Worker ID should be a self-incremental index obtained from a source which is
unique and parallel-safe. 9-bit's length supports maximum 512 Workers running
at the same time.  
  
A TTL for worker ID is necessary for each Worker.  Currently, it's a fixed value
of 3600 seconds.

#### 3. Sequence Number: 10-bit

A self-incremental number generated by a Worker. Increases from 0 to 1023, then
back to 0 again.  
  
Sequence number must be unique in one second. If all sequence numbers are used
in that second,  the generator must wait until the next second.  
  
Combining the sequence number with the Worker ID, the generator can generate
`2 ** 19` unique IDs per second. It should be far more than enough for normal
usage.

#### 4. Random bits: 9-bit

No special requirements.

### Display Format

Storage format is designed for conveniently saving, indexing and comparing in  the database. When displaying to users, storage format is converted to a base64-like string for better readability.
  
Frequently variable parts of the string are placed at the beginning and the end
of it on purpose, so it looks like a complete random ID.
 
#### Characters

Every 6 bits are converted to the following characters (from 000000 to 111111):

```
ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_
```

#### Rule

Decoding from the storage format to display format: reverse 32-bit timestamp,
and convert every 6 bits to characters in order.  

Encoding is the reverse of decoding.
